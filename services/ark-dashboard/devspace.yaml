# DevSpace configuration for ark-dashboard service
version: v2beta1

images:
  ark-dashboard:
    image: ark-dashboard
    dockerfile: Dockerfile
    context: .

pipelines:
  deploy: |-
    build_images --all
    create_deployments --all
  dev: |-
    create_deployments --all
    start_dev --all

deployments:
  ark-dashboard:
    namespace: default
    helm:
      chart:
        path: ./chart
      values:
        app:
          image:
            repository: ${runtime.images.ark-dashboard.image}
            tag: ${runtime.images.ark-dashboard.tag}
          # Override resources for local development
          resources:
            limits:
              memory: "3072Mi"
              cpu: "2000m"
            requests:
              memory: "256Mi"
              cpu: "200m"
          config:
            arkApiService:
              host: "ark-api.default.svc.cluster.local"
              port: "8000"
              protocol: "http"
            arkSessionsService:
              host: "ark-sessions.default.svc.cluster.local"
              port: "80"
              protocol: "http"
        httpRoute:
          enabled: false

dev:
  ark-dashboard:
    imageSelector: ark-dashboard
    devImage: node:24-alpine
    env:
      - name: NODE_ENV
        value: development
      - name: ARK_API_SERVICE_HOST
        value: ark-api.default.svc.cluster.local
      - name: ARK_API_SERVICE_PORT
        value: "8000"
      - name: ARK_API_SERVICE_PROTOCOL
        value: "http"
      - name: ARK_SESSIONS_SERVICE_HOST
        value: ark-sessions.default.svc.cluster.local
      - name: ARK_SESSIONS_SERVICE_PORT
        value: "80"
      - name: ARK_SESSIONS_SERVICE_PROTOCOL
        value: "http"
    command:
      [
        "sh",
        "-c",
        "cd /app/ark-dashboard && if [ ! -d node_modules ]; then npm install -g pnpm && pnpm install; fi && exec pnpm run dev",
      ]
    namespace: default
    # Stream logs instead of terminal
    logs:
      lastLines: 50
    # File synchronization for hot reload
    sync:
      - path: .:/app
        startContainer: true
        disableDownload: true
        uploadExcludeFile: .dockerignore
        excludePaths:
          - "**/node_modules"
          - "**/.next"
          - "**/out"
    # Enable SSH for IDE integration
    ssh:
      enabled: true

