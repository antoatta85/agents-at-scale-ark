{{- if .Values.demos.weather.enabled }}
---
apiVersion: ark.mckinsey.com/v1alpha1
kind: Agent
metadata:
  name: weather-fetcher
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "ark-demos.labels" . | nindent 4 }}
    {{- include "ark-demos.demoLabels" .Values.demos.weather | nindent 4 }}
    demo.ark.mckinsey.com/component: agent
spec:
  description: "Weather agent that fetches forecast data"
  prompt: |
    You are a weather assistant. Use the weather tool to get forecast data 
    for the requested location. Provide clear, concise weather information.
  modelRef:
    name: {{ .Values.model.name }}
  tools:
    - type: custom
      name: {{ .Values.tools.weather.name }}

---
apiVersion: ark.mckinsey.com/v1alpha1
kind: Agent
metadata:
  name: weather-storage
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "ark-demos.labels" . | nindent 4 }}
    {{- include "ark-demos.demoLabels" .Values.demos.weather | nindent 4 }}
    demo.ark.mckinsey.com/component: agent
spec:
  description: "Weather agent that stores forecast data to files"
  prompt: |
    You are a file management assistant. Store weather reports to the filesystem 
    with descriptive filenames. List existing files before writing and use unique 
    names if files already exist.
  modelRef:
    name: {{ .Values.model.name }}
  tools:
    {{- range .Values.tools.filesys.tools }}
    - type: custom
      name: {{ . }}
    {{- end }}

---
apiVersion: ark.mckinsey.com/v1alpha1
kind: Team
metadata:
  name: weather-workflow-team
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "ark-demos.labels" . | nindent 4 }}
    {{- include "ark-demos.demoLabels" .Values.demos.weather | nindent 4 }}
    demo.ark.mckinsey.com/component: team
spec:
  description: "Weather workflow team for fetching and storing weather data"
  members:
    - name: weather-fetcher
      type: agent
    - name: weather-storage
      type: agent
  strategy: sequential
  maxTurns: 2

---
apiVersion: ark.mckinsey.com/v1alpha1
kind: Query
metadata:
  name: weather-query
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "ark-demos.labels" . | nindent 4 }}
    {{- include "ark-demos.demoLabels" .Values.demos.weather | nindent 4 }}
    demo.ark.mckinsey.com/component: query
  annotations:
    "helm.sh/hook": post-install,post-upgrade
    "helm.sh/hook-weight": "1"
    "helm.sh/hook-delete-policy": before-hook-creation
spec:
  input: "Get weather forecast for Chicago and save the report to a file"
  targets:
    - type: team
      name: weather-workflow-team
{{- end }}
